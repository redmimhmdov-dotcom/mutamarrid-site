<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>نظام تسجيل العملاء الذكي</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'Cairo', sans-serif;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background-color: #111;
      padding: 20px;
      border-radius: 10px;
    }
    input, select, textarea, button {
      margin: 10px;
      padding: 10px;
      width: 90%;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      background-color: #fff;
      color: #000;
    }
    button {
      background-color: #ff0055;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #ff3366;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
      background-color: #222;
    }
    th, td {
      padding: 8px;
      border: 1px solid #444;
      color: #fff;
    }
    input[type="search"] {
      width: 50%;
      margin-bottom: 10px;
      background-color: #fff;
      color: #000;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>📲 نظام تسجيل وتفعيل الحسابات</h2>
        <h2> مكــتب الفــرات معكم اينما تكونو</h2>
    <form id="clientForm">
      <input type="text" name="name" placeholder="اسم العميل" required><br>
      <select name="service" required>
        <option value="">اختر نوع الحساب</option>
        <option value="واتساب">واتساب</option>
        <option value="شام كاش">شام كاش</option>
        <option value="فيسبوك">فيسبوك</option>
        <option value="انستغرام">انستغرام</option>
        <option value="تيليجرام">تيليجرام</option>
      </select><br>
      <select name="status" required>
        <option value="">حالة التفعيل</option>
        <option value="✅ واصل">✅ واصل</option>
        <option value="❌ غير واصل">❌ غير واصل</option>
      </select><br>
      <input type="text" name="phone" placeholder="رقم الهاتف" required><br>
      <textarea name="notes" placeholder="ملاحظات إضافية"></textarea><br>
      <button type="submit">💾 تسجيل</button>
    </form>

    <input type="search" id="searchInput" placeholder="🔍 ابحث عن عميل...">

    <table id="clientTable">
      <thead>
        <tr>
          <th>الاسم</th>
          <th>عدد التكرار</th>
          <th>الخدمة</th>
          <th>الحالة</th>
          <th>الهاتف</th>
          <th>ملاحظات</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const form = document.getElementById("clientForm");
    const tableBody = document.querySelector("#clientTable tbody");
    const searchInput = document.getElementById("searchInput");

    const TOKEN = "7054208207:AAHVwwMlay45aLFyQn4FCJyfWM_-AoQXpMM";
    const CHAT_ID = "7493001551";

    let clients = JSON.parse(localStorage.getItem("clients")) || [];

    function saveClients() {
      localStorage.setItem("clients", JSON.stringify(clients));
    }

    function sendToTelegram(data) {
      const message = `📥 تسجيل جديد:\n👤 الاسم: ${data.name}\n📱 الخدمة: ${data.service}\n📶 الحالة: ${data.status}\n📞 الهاتف: ${data.phone}\n📝 ملاحظات: ${data.notes || "لا يوجد"}`;
      fetch(`https://api.telegram.org/bot${TOKEN}/sendMessage`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ chat_id: CHAT_ID, text: message })
      });
    }

    function updateTable() {
      tableBody.innerHTML = "";
      const grouped = {};

      clients.forEach(c => {
        const key = c.name + "_" + c.phone;
        if (!grouped[key]) {
          grouped[key] = { ...c, count: 1 };
        } else {
          grouped[key].count++;
        }
      });

      Object.values(grouped).forEach(data => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.name}</td>
          <td>${data.count}</td>
          <td>${data.service}</td>
          <td>${data.status}</td>
          <td>${data.phone}</td>
          <td>${data.notes || "—"}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    form.addEventListener("submit", function(e) {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      clients.push(data);
      saveClients();
      updateTable();
      sendToTelegram(data);
      form.reset();
    });

    searchInput.addEventListener("input", function() {
      const term = this.value.toLowerCase();
      tableBody.querySelectorAll("tr").forEach(row => {
        const match = Array.from(row.children).some(td => td.textContent.toLowerCase().includes(term));
        row.style.display = match ? "" : "none";
      });
    });

    // تحميل البيانات عند فتح الصفحة
    updateTable();
  </script>
</body>
</html>